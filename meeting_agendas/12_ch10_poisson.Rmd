---
title: "Bayesian Inference for the Poisson mean (Ch.10)"
author: "AG Schissler"
date: "8 Mar 2021 (*updated: `r Sys.Date()`)*"
output:
  ioslides_presentation:
    widescreen: true
    smaller: true
---

```{r setup, include=FALSE}
library(tidyverse)
library(printr)
library(Bolstad)
## xaringan::inf_mr('12_ch10_poisson.Rmd')
```

# Admin & Startup

## Schedule review 

Let's review the schedule and place today's learning in context.  

## Action items this week

- Read Chapter 9, 10.
- Will get your grades up to date before drop day.
- Problem Set 4, Ch. 7 is due Friday, 5 Mar 2021.
- Problem Set 5, Ch. 8 is due Friday, 12 Mar 2021.
- Problem Set 6, Ch. 9, 10 is due Friday, 19 Mar 2021.
- Midterm 2 (canvas quiz format) is due Friday, 19 Mar 2021.

## Any questions over problem set 5, Ch. 8?

Problem Set 5, Ch. 8. #2,4,5, C1-C6.

## Today's plan

- Prime by reading HW 6, ch. 9, 10 exercise prompts.
- Discussion Ch. 10
- Summarize, Revisit HW or Q & A

*Please contribute questions and comments*

# I. Problem Set 6, Ch. 9, 10

- Ch.9 #1-3,C1
- Ch.10 #2, C1,C3-C6 

# Ch. 10 Poisson inference notes and example

## Ch. 10 Key concepts 1

- Gamma is the conjugate family for Poisson observations, with density proportional to $\mu^{r-1} e^{-v\mu}; \mu \geq 0, r,v > 0$. Here $r$ is the *shape* parameter and $v$ is the *rate* parameter (1/rate is the *scale* parameterization).
- If the prior is $gamma(r, v)$, then the posterior, $\mu|y$, is $gamma\left(r^\prime = \sum y + r, v^\prime = n + v \right)$.
- The posterior mean, $E[\mu|y]$, is $\frac{r^\prime}{v^\prime}$.
- The posterior mode is $\frac{r^\prime - 1}{v^\prime}$.
- The posterior variance, $Var[\mu|y]$, is $\frac{r^\prime}{{v^\prime}^2}$.

## Ch. 10 Key concepts 2

The posterior median must be found numerically:

```{r}
r_prime <- 2
v_prime <- 1
## CAREFUL: v is the "rate" parameter in R
## not the scale (1/v).
## Let's read ?qgamma
my_area <- 0.5
q2 <- qgamma(p = my_area, shape = r_prime, rate = v_prime)
cat(paste( "Median is", q2))
```

## Ch. 10 Key concepts 3

- Equivalent sample size is $n_{eq}=v$.
- Bias of the "best" Bayesian point estimator (the posterior mean, $\hat{\mu_B}$): $E[\hat{\mu_B}] - \mu = \frac{r - v\mu}{v + n}$.
- Variance of the "best" Bayesian point estimator: $Var[\hat{\mu_B}] = \frac{n\mu}{(v + n)^2}$.
- Positive uniform (improper) density is defined as $1, \mu \geq 0$. This can be viewed as the limit of a gamma with $r = 1, v \rightarrow 0$.
- Jeffrey's prior (improper) density is $\mu^{-1/2}, \mu > 0$. This can be viewed as the limit of a gamma with $r = 1/2, v \rightarrow 0$.

## Example: Bolstad Ch.10, 10.1

```{r}
## OUR CODE HERE
```

## You try: HW 7, Ch.10 Exercise 10.2

## Example Ch. 10, C2 Using `R`

```{r}
y = c(3, 4, 3, 0, 1)
## Jeffrey's prior
r <- 0.5
v <- 0
(r_prime <- r + sum(y))
(v_prime <- v + length(y))
```

---

```{r}
## mean
r_prime / v_prime
## median
qgamma(p = 0.5, shape = r_prime, rate = v_prime)
## 95% posterior credible interval
alpha = 0.05
(lower <- qgamma(p = alpha / 2, shape = r_prime, rate = v_prime))
(upper <- qgamma(p = alpha / 2, shape = r_prime, rate = v_prime, lower.tail = FALSE))
```

## Example Ch. 10, C2 Using `Bolstad`

```{r}
my_posterior <- Bolstad::poisgamp(y = y, shape = 0.5, rate = 0, quiet=T)
```

---

```{r}
mean(my_posterior)
quantile(my_posterior, probs = 0.5)
round(quantile(my_posterior, probs = c(alpha / 2, 1 - ( alpha / 2 ) )), 2)
```

# III. Revisit Problem Set 6, Ch. 9, 10

New questions over:

- Ch.9 #1-3,C1
- Ch.10 #2, C1,C3-C6 

# Closing

- What are the updating rules for conjugate-based Bayesian inference of the mean from a Poisson random variable?
- Questions about anything?
