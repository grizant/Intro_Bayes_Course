---
title: "Bayesian Inference for Difference Between Means (Ch.13)"
author: "AG Schissler"
date: "04/08/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<bring to class: laptop>

## Start-of-class work: Many times a day do you check email? (5 - 10 min)

1. Think carefully about how many times a day do you check email, $\mu$, in a 24-hour period.
2. Record your guess.
3. Construct your two priors for this average, one for the UNR graduate and one for the UNR undergraduate students.

## II. Perform Bayesian inference for these data (10 - 15 min)

1. Bring together class data, noting if the student belongs to the graduate population or the undergraduate population.
2. Construct the posterior distribution for each group, assumming independent random samples from two normal distributions and known standard deviation of 10.

```{r, echo = TRUE, results = TRUE}
y_u <- c(10, 3,3, 5,8,10,1,4,8,8,6,15,15,2,6,4,15,15,3,10,3,6,4,6,8,10)
y_g <- c(3.5, 8, 10,6,15,20,7,25,40,12)

## 
m <- 10
s2 <- 5^2
## assume more sleep, more variation over Spring Break
## y_bar <- mean(sleep)
## n <- length(sleep)
sigma2 <- 10^2

compute_mean_posterior <- function(m, s2, n, y_bar, sigma2){
    ## posterior precision is the sum of prior and sample precision
    total_precision <- 1/s2 + n/sigma2
    s_prime2 <- 1/total_precision
    ## posterior mean is the weighted average of prior and sample mean
    m_prime <- ( (1/s2) / total_precision ) * m + ( (n/sigma2) / total_precision ) * y_bar
    ## return as a list
    list(m_prime=m_prime, s_prime2=s_prime2, s_prime = sqrt(s_prime2))
}

mu_u_post <- compute_mean_posterior(m = m, s2 = s2, n =  length(y_u), y_bar = mean(y_u), sigma2 = 10^2)

mu_g_post <- compute_mean_posterior(m = m, s2 = s2, n =  length(y_g), y_bar = mean(y_g), sigma2 = 10^2)

## Bolstad::normnp(x = sleep, m.x = 7, s.x = 1, sigma.x = 1, plot = TRUE)
```

## III. Inference with equal variances (13.2; 20 - 25 min)

How to quantify and test any difference between the groups?

### 1. Using the results from the previous section, find a 95% credible interval the mean difference.

```{r}
mu_d_mean <- mu_g_post$m_prime - mu_u_post$m_prime
mu_d_stderror <- sqrt(mu_g_post$s_prime2 + mu_u_post$s_prime2)

c(mu_d_mean - qnorm(0.975) * mu_d_stderror, mu_d_mean + qnorm(0.975) * mu_d_stderror)

pnorm(0, mean = mu_d_mean, sd = mu_d_stderror)

pnorm((0 - mu_d_mean) / mu_d_stderror)

```

### 2. Now test the hypotheses that

$H_0: \mu_d \leq 0$ versus $H_0: \mu_d > 0$.

### 3. And the two-sided test

$H_0: \mu_d = 0$ versus $H_0: \mu_d \neq 0$.

### 4. Repeat 1-3, but assume unknown (but equal) variance with flat priors

Hint: Use $t(n_u + n_g - 2)$.

## IV. Inferences with unequal variances (12.; 5 - 10 min)
  
### Example 12.2 (continued from Example 11.3, p. 222)

Discuss using projected textbook.

## IV. Now let's do the same analysis with unequal variances (10 - 15 min)

Assume that $\sigma_u = 10$ and $\sigma_g = 5$ and use equation (13.10).

### Now assume the variances are unequal & unknown

Use Satterthwaite's approximation for the degrees of freedom on page 263.

## V. Finally let's collect data and think about a paired design (10 - 15 min)

1. Think about how many times you check your email on a weekday versus a weekend day.
2. Provide those data with the class.
3. Let's disregard the graduate/undergraduate aspect for this analysis.

```{r}
diff_in_email <- c(5,3,1,1,2.5,4,6,4.09,4,5,1,3,6,5,10,1,20,5.5,5,6,3,30,4,3,2,0,15, 2,5,1,9,4,1,4,5,2)

summary(diff_in_email)
hist(diff_in_email)

(post_param <- compute_mean_posterior(m = 0, 20^2, n = length(diff_in_email), y_bar = mean(diff_in_email), sigma2 = var(diff_in_email)))

```

### Construct the posterior of the differencen $\mu_{weekday} - \mu_{weekend}$ using a flat prior.

How to do this?

Construct a 95% credible interval.

```{r}
n <- length(diff_in_email)
qt(p = 0.95, df = n - 1)

post_param$m_prime - qt(p = 0.95, df = n - 1) * post_param$s_prime

post_param$m_prime + qt(p = 0.95, df = n - 1) * post_param$s_prime

t.test(x = diff_in_email,conf.level = 0.9)

```

## Closing (5 - 10 min)

Think-pair-share:

1. Think about ways to make predictions from a Frequentist perspective.
2. Pair and discuss your thoughts.
3. Share with the class.
